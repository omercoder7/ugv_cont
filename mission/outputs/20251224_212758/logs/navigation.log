[OUTPUT] Logging to: /home/ws/ugv_cont/mission/outputs/20251224_212758
[OUTPUT] Log file: /home/ws/ugv_cont/mission/outputs/20251224_212758/logs/navigation.log
=======================================================
NEXT-BEST-VIEW (NBV) NAVIGATION
=======================================================
Speed: 0.08 m/s
Goal distance: 0.5-2.0m
Press Ctrl+C to stop

[DEBUG] Marker publishing enabled - check /nav_goal in RViz
[MARKER] Persistent marker publisher started - add /nav_goal in RViz
[START] Initial position: (-0.02, 0.19)
[START] Origin wall signature: ['0.67', '0.65', '0.63', '0.62', '0.62', '0.62', '0.63', '0.65', '0.67', '0.71', '0.75', '1.12', '1.05', '0.98', '0.78', '0.69', '0.65', '0.68', '0.69', '0.67', '0.74', '0.78', '0.82', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '5.00', '0.59', '0.62', '1.37', '1.49', '1.66', '1.89', '3.56', '3.56', '5.33', '1.62', '1.63', '1.15', '1.16', '1.19', '1.23', '1.29', '1.35', '1.31', '0.82', '0.72', '0.70', '0.69']
[MARKER] Origin marker (blue) started at (-0.02, 0.19) - add /nav_origin in RViz

[  2.4s] [GOAL SELECT] robot@(-0.02,0.19) | 21 candidates (scanned=57 walls=23 visited=1):
  #1 ang= -94° d=2.00m pos=(0.87,1.98) score=+38.3 [O=+2.5 U=+35.2 V=-0.0 W=-0.0 R=-0.0 F=+0.0] <-- BEST
  #2 ang= -45° d=0.50m pos=(-0.22,0.65) score=+36.9 [O=+1.7 U=+38.0 V=-0.0 W=-3.0 R=-0.0 F=+0.0]
  #3 ang= -52° d=0.50m pos=(-0.17,0.67) score=+36.8 [O=+1.7 U=+38.0 V=-0.0 W=-3.0 R=-0.0 F=+0.0]
  #4 ang= +70° d=0.50m pos=(-0.35,-0.18) score=+35.8 [O=+1.6 U=+40.0 V=-3.0 W=-3.0 R=-0.0 F=+0.0]
  #5 ang= +76° d=0.50m pos=(-0.31,-0.22) score=+35.7 [O=+1.6 U=+40.0 V=-3.0 W=-3.0 R=-0.0 F=+0.0]
  #6 ang= -39° d=0.50m pos=(-0.26,0.63) score=+34.9 [O=+1.8 U=+36.0 V=-0.0 W=-3.0 R=-0.0 F=+0.0]
  #7 ang= -82° d=1.00m pos=(0.22,1.16) score=+33.8 [O=+2.5 U=+34.0 V=-0.0 W=-3.0 R=-0.0 F=+0.0]
  #8 ang= -70° d=0.50m pos=(-0.01,0.69) score=+33.3 [O=+2.1 U=+34.0 V=-0.0 W=-3.0 R=-0.0 F=+0.0]
[  4.8s] [GOAL] Selected: (0.87, 1.98) dist=2.00m timeout=50s angle=-94° reason=no goal
[  1] DRIVE goal=(0.87,1.98) dist=2.00m front=0.62m cells=1 rms=0.0cmWaiting for LiDAR...
Waiting for LiDAR...
[  4] DRIVE goal=(0.87,1.98) dist=2.16m front=0.58m cells=1 rms=7.6cm[  5] DRIVE goal=(0.87,1.98) dist=2.17m front=0.58m cells=1 rms=8.0cm[  6] DRIVE goal=(0.87,1.98) dist=2.17m front=0.59m cells=1 rms=9.2cm[  7] DRIVE goal=(0.87,1.98) dist=2.18m front=1.15m cells=1 rms=11.1cm
[ 21.0s] [TURN ENTER] Entering TURN mode

[BLOCKED DEBUG] Goal angle: -31.9° (sector 54), goal_dist: 2.18m, threshold: 2.03m
[BLOCKED DEBUG] Checking 3 sectors: {54: 0.425, 55: 0.448, 53: 0.42}
[BLOCKED DEBUG] min: 0.42m, max: 0.45m
[BLOCKED DEBUG] Blocked if ALL < 2.03? max=0.45 < 2.03? True
[BLOCKED DEBUG] (Full front arc for reference: {55: 0.448, 56: 0.477, 57: 0.512, 58: 0.569, 59: 1.371, 0: 1.515, 1: 1.713, 2: 3.605, 3: 3.544, 4: 3.612, 5: 5.333})

[BLOCKED TURN] goal_sector=54, best_sector=52 (dist=0.53m), target_angle=-48.0°, angle_error=-48.0°, v=0.00, w=-0.50
[  8] TURN goal=(0.87,1.98) dist=2.18m front=0.45m cells=1 rms=12.3cm
[ 26.7s] [TURN STUCK] In TURN mode for 5.7s, backing up
[TURN STUCK] Position history (1 samples):
  [0]: (0.04, -0.02) heading=60.6°
[TURN STUCK] Current front sectors: s55=0.50 s56=0.50 s57=0.50 s58=0.50 s59=0.40 s0=0.40 s1=0.42 s2=0.45 s3=0.49 s4=0.55 s5=1.36 

[BACKUP CLEAR] Reversing and turning toward clearer side...
[BACKUP CLEAR] Turning left (L_avg=0.65m R_avg=0.48m)

[ 34.9s] [REFINE] only 0 candidates, resampling with 150 angles (level 1)

[ 34.9s] [REFINE] only 1 candidates, resampling with 450 angles (level 2)

[ 34.9s] [REFINE] only 2 candidates, resampling with 1350 angles (level 3)

[ 34.9s] [GOAL SELECT] robot@(-0.20,-0.36) | 7 candidates (refined 3x) (scanned=109 walls=56 visited=2):
  #1 ang= +37° d=2.00m pos=(-1.24,1.34) score=+26.7 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-9.9] <-- BEST
  #2 ang= +37° d=2.00m pos=(-1.24,1.34) score=+26.7 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-9.9]
  #3 ang= +37° d=2.00m pos=(-1.23,1.35) score=+26.6 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-10.0]
  #4 ang= +36° d=2.00m pos=(-1.22,1.35) score=+26.6 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-10.0]
  #5 ang= +36° d=2.00m pos=(-1.22,1.36) score=+26.5 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-10.0]
  #6 ang= +36° d=2.00m pos=(-1.21,1.36) score=+26.5 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-10.1]
  #7 ang= +36° d=2.00m pos=(-1.20,1.36) score=+26.4 [O=+1.8 U=+35.2 V=-0.0 W=-1.0 R=-0.0 F=-10.1]
[ 36.8s] [GOAL] Selected: (-1.24, 1.34) dist=2.00m timeout=50s angle=37° reason=no goal
[ 11] DRIVE goal=(-1.24,1.34) dist=2.00m front=0.55m cells=2 rms=11.4cm
[ 39.8s] [TURN ENTER] Entering TURN mode

[BLOCKED DEBUG] Goal angle: 29.1° (sector 4), goal_dist: 2.00m, threshold: 1.85m
[BLOCKED DEBUG] Checking 3 sectors: {4: 1.642, 5: 1.84, 3: 1.511}
[BLOCKED DEBUG] min: 1.51m, max: 1.84m
[BLOCKED DEBUG] Blocked if ALL < 1.85? max=1.84 < 1.85? True
[BLOCKED DEBUG] (Full front arc for reference: {55: 0.646, 56: 0.649, 57: 0.546, 58: 0.558, 59: 0.586, 0: 0.621, 1: 0.672, 2: 1.401, 3: 1.511, 4: 1.642, 5: 1.84})

[BLOCKED TURN] goal_sector=4, best_sector=4 (dist=1.64m), target_angle=24.0°, angle_error=24.0°, v=0.00, w=0.50
[ 12] TURN goal=(-1.24,1.34) dist=2.00m front=0.55m cells=2 rms=10.7cm[ 13] DRIVE goal=(-1.24,1.34) dist=1.99m front=0.58m cells=2 rms=10.1cm[ 14] DRIVE goal=(-1.24,1.34) dist=1.80m front=1.11m cells=3 rms=9.6cm[ 15] DRIVE goal=(-1.24,1.34) dist=1.55m front=1.03m cells=3 rms=9.4cm[ 16] DRIVE goal=(-1.24,1.34) dist=1.32m front=0.94m cells=4 rms=9.8cm[ 17] DRIVE goal=(-1.24,1.34) dist=1.00m front=0.86m cells=5 rms=10.1cm
[ 54.9s] [GOAL SELECT] robot@(-1.02,1.02) | 6 candidates (scanned=146 walls=78 visited=6):
  #1 ang=  +9° d=1.50m pos=(-1.60,2.40) score=+38.5 [O=+1.8 U=+24.0 V=-0.0 W=-1.0 R=-0.0 F=+13.3] <-- BEST
  #2 ang= -21° d=0.50m pos=(-0.95,1.51) score=+26.7 [O=+1.6 U=+23.3 V=-0.0 W=-3.0 R=-3.3 F=+8.0]
  #3 ang=  +9° d=1.00m pos=(-1.41,1.94) score=+25.6 [O=+2.3 U=+16.0 V=-0.0 W=-3.0 R=-3.3 F=+13.3]
  #4 ang= -15° d=0.50m pos=(-1.00,1.52) score=+25.5 [O=+1.7 U=+20.7 V=-0.0 W=-3.0 R=-3.3 F=+9.3]
  #5 ang=  -9° d=0.50m pos=(-1.06,1.52) score=+24.2 [O=+1.7 U=+18.2 V=-0.0 W=-3.0 R=-3.3 F=+10.5]
  #6 ang=  -3° d=0.50m pos=(-1.11,1.51) score=+19.3 [O=+1.8 U=+12.1 V=-0.0 W=-3.0 R=-3.3 F=+11.6]
[ 56.9s] [GOAL] Selected: (-1.60, 2.40) dist=1.50m timeout=42s angle=9° reason=reached
[ 18] DRIVE goal=(-1.60,2.40) dist=1.50m front=1.06m cells=6 rms=9.7cm[ 19] DRIVE goal=(-1.60,2.40) dist=0.80m front=0.81m cells=7 rms=10.6cm[ 20] DRIVE goal=(-1.60,2.40) dist=0.71m front=0.79m cells=8 rms=11.5cm
[ 64.9s] [GOAL SELECT] robot@(-1.41,2.18) | 12 candidates (scanned=181 walls=113 visited=9):
  #1 ang= -27° d=2.00m pos=(-2.68,3.72) score=+54.3 [O=+1.7 U=+38.0 V=-0.0 W=-1.0 R=-0.0 F=+15.0] <-- BEST
  #2 ang= -21° d=2.00m pos=(-2.83,3.58) score=+54.0 [O=+1.6 U=+38.0 V=-0.0 W=-1.0 R=-0.0 F=+14.7]
  #3 ang= -27° d=1.50m pos=(-2.36,3.34) score=+46.7 [O=+2.2 U=+30.0 V=-0.0 W=-1.0 R=-0.0 F=+15.0]
  #4 ang=  -9° d=1.00m pos=(-2.25,2.71) score=+38.8 [O=+2.5 U=+25.2 V=-0.0 W=-3.0 R=-0.0 F=+13.8]
  #5 ang= -27° d=1.00m pos=(-2.04,2.95) score=+38.8 [O=+2.5 U=+22.0 V=-0.0 W=-1.0 R=-0.0 F=+15.0]
  #6 ang= -33° d=1.00m pos=(-1.96,3.01) score=+38.2 [O=+1.7 U=+22.2 V=-0.0 W=-1.0 R=-0.0 F=+15.0]
  #7 ang= -21° d=1.00m pos=(-2.12,2.88) score=+37.7 [O=+2.5 U=+23.2 V=-0.0 W=-3.0 R=-0.0 F=+14.7]
  #8 ang= -15° d=1.00m pos=(-2.19,2.80) score=+35.4 [O=+2.5 U=+21.2 V=-0.0 W=-3.0 R=-0.0 F=+14.4]
[ 67.2s] [GOAL] Selected: (-2.68, 3.72) dist=2.00m timeout=50s angle=-27° reason=reached
[ 21] DRIVE goal=(-2.68,3.72) dist=2.00m front=0.72m cells=9 rms=11.1cm[ 22] DRIVE goal=(-2.68,3.72) dist=1.82m front=0.35m cells=10 rms=11.6cm[ 23] DRIVE goal=(-2.68,3.72) dist=1.88m front=0.36m cells=10 rms=11.3cm

=======================================================
[77.8s] RETURNING TO ORIGIN
=======================================================
Time elapsed: 77.8s / 100.0s (78%)
Origin: (-0.02, 0.19)
Current: (-0.90, 2.31)
Distance to origin: 2.30m
=======================================================


[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-3, 7) to cell (0, 0)
[A* PLAN] World: (-0.90,2.31) -> (-0.02,0.19)
[A* PLAN] Distance: 2.30m
[A* PLAN] Grid res: 0.3m, Inflation: 2 cells = 0.60m clearance
[A* PLAN] Map: 143 walls, 211 scanned, 11 visited
[A* PLAN] Inflated obstacles: 376 cells (inflation=2, unreachable=0)
[A* PLAN] Closest wall to START: (-3, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 11 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 5 iterations
[A* DEBUG] Explored 5 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A* RETRY] No path with inflation=2, trying inflation=1...

[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-3, 7) to cell (0, 0)
[A* PLAN] World: (-0.90,2.31) -> (-0.02,0.19)
[A* PLAN] Distance: 2.30m
[A* PLAN] Grid res: 0.3m, Inflation: 1 cells = 0.30m clearance
[A* PLAN] Map: 143 walls, 211 scanned, 11 visited
[A* PLAN] Inflated obstacles: 274 cells (inflation=1, unreachable=0)
[A* PLAN] Closest wall to START: (-3, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 11 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 5 iterations
[A* DEBUG] Explored 5 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A* RETRY] No path with inflation=1, trying inflation=0...

[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-3, 7) to cell (0, 0)
[A* PLAN] World: (-0.90,2.31) -> (-0.02,0.19)
[A* PLAN] Distance: 2.30m
[A* PLAN] Grid res: 0.3m, Inflation: 0 cells = 0.00m clearance
[A* PLAN] Map: 143 walls, 211 scanned, 11 visited
[A* PLAN] Inflated obstacles: 143 cells (inflation=0, unreachable=0)
[A* PLAN] Closest wall to START: (-3, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 7 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 7 iterations
[A* DEBUG] Explored 7 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A*] No path found! Will use direct navigation
[ 25] RETURN DRIVE direct goal=(-0.02,0.19) origin_dist=2.30m front=0.56m[ 26] RETURN DRIVE direct goal=(-0.02,0.19) origin_dist=2.25m front=0.74m
[ 86.2s] [A*] Stuck for 8.4s (no movement/rotation), replanning...
[LIDAR UPDATE] No new walls (all 150 already known)

[BACKUP] Reversing...
[BACKUP] Turning right (L_openings=7 R_openings=7)

[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-2, 7) to cell (0, 0)
[A* PLAN] World: (-0.82,2.29) -> (-0.02,0.19)
[A* PLAN] Distance: 2.24m
[A* PLAN] Grid res: 0.3m, Inflation: 2 cells = 0.60m clearance
[A* PLAN] Map: 150 walls, 211 scanned, 12 visited
[A* PLAN] Inflated obstacles: 377 cells (inflation=2, unreachable=0)
[A* PLAN] Closest wall to START: (-2, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 12 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 6 iterations
[A* DEBUG] Explored 6 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A* RETRY] No path with inflation=2, trying inflation=1...

[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-2, 7) to cell (0, 0)
[A* PLAN] World: (-0.82,2.29) -> (-0.02,0.19)
[A* PLAN] Distance: 2.24m
[A* PLAN] Grid res: 0.3m, Inflation: 1 cells = 0.30m clearance
[A* PLAN] Map: 150 walls, 211 scanned, 12 visited
[A* PLAN] Inflated obstacles: 276 cells (inflation=1, unreachable=0)
[A* PLAN] Closest wall to START: (-2, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 12 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 6 iterations
[A* DEBUG] Explored 6 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A* RETRY] No path with inflation=1, trying inflation=0...

[A* PLAN] ========== PATH PLANNING START ==========
[A* PLAN] From cell (-2, 7) to cell (0, 0)
[A* PLAN] World: (-0.82,2.29) -> (-0.02,0.19)
[A* PLAN] Distance: 2.24m
[A* PLAN] Grid res: 0.3m, Inflation: 0 cells = 0.00m clearance
[A* PLAN] Map: 150 walls, 211 scanned, 12 visited
[A* PLAN] Inflated obstacles: 150 cells (inflation=0, unreachable=0)
[A* PLAN] Closest wall to START: (-2, 7) at 0.0 cells = 0.00m
[A* PLAN] Closest wall to GOAL: (0, -1) at 1.0 cells = 0.30m
[A* PLAN] Cleared 8 visited cells from obstacles (guaranteed traversable)
[A* DEBUG] Cleared 6 cells around goal (radius=1)
[A* PLAN] Start in obstacles: False, Goal in obstacles: False
[A* DEBUG] NO PATH FOUND after 7 iterations
[A* DEBUG] Explored 7 cells, open set had 0 remaining
[A* DEBUG] Closest reachable cell: (-3, 5), dist to goal: 5.8 cells
[A* DEBUG] Goal neighbors blocked: 0/8
[A*] Replan failed, using direct navigation
[ 31] RETURN DRIVE direct goal=(-0.02,0.19) origin_dist=2.16m front=0.77m[ 32] RETURN DRIVE direct goal=(-0.02,0.19) origin_dist=2.14m front=0.76m[ 33] RETURN DRIVE direct goal=(-0.02,0.19) origin_dist=2.14m front=0.78m[ 35] RETURN TURN direct goal=(-0.02,0.19) origin_dist=2.11m front=1.10m[ 36] RETURN TURN direct goal=(-0.02,0.19) origin_dist=2.11m front=1.09m[ 37] RETURN TURN direct goal=(-0.02,0.19) origin_dist=2.14m front=1.10mWaiting for LiDAR...


Stopping (Ctrl+C)...
[MARKER] Publisher stopped

=======================================================
NBV NAVIGATION COMPLETE
=======================================================
Final state: returning
Duration: 111.5s
Iterations: 38
Goals reached: 2
Backups: 2
Unique cells visited: 13
Cells scanned by LiDAR: 217
Walls detected: 166

--- Drive Accuracy ---
Cross-track RMS error: 11.3cm
Total distance traveled: 4.04m
Ideal distance (sum of goals): 7.50m
Drive efficiency: 185.9%

--- Return Phase ---
Return phase duration: 33.6s
Final distance to origin: 2.14m
Revisit rate: 100.0%

--- Map Accuracy Suggestions ---
To measure map accuracy, consider:
1. Ground truth comparison: Place markers at known positions,
   compare measured vs actual distances between them
2. Loop closure error: After returning to origin, check
   odometry drift (final_dist to origin should be ~0)
3. Feature alignment: Compare map walls to actual room layout
4. Consistency check: Run multiple times, overlay maps
5. Tape measure validation: Measure actual room dimensions,
   compare to map scale (resolution * pixels)
[OUTPUT] Map saved to: /home/ws/ugv_cont/mission/outputs/20251224_212758/maps
